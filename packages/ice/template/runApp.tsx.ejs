import { Runtime, renderRouter, render } from '@ice/runtime';
import loadStaticModules from './loadStaticModules';
import loadRuntimeModules from './loadRuntimeModules';
import type { AppConfig } from './types';
import routes from './routes';

export function runApp(config: AppConfig = {}) {
  const appConfig = {
    ...config,
    app: {
      rootId: 'root',
      ...(config?.app || {}),
    },
  };
  loadStaticModules(appConfig);
  // TODO generate buildConfig
  const buildConfig = {
    ssr: false,
  };
  // TODO create context
  const context = {
    enableRouter: true,
    routes,
  };

  const runtime = new Runtime(appConfig, buildConfig, context);

  runtime.setRenderApp(renderRouter);

  loadRuntimeModules(runtime);
  render(runtime);
}