// Define process.env in top make it possible to use ICE_CORE_* in @ice/runtime, esbuild define options doesn't have the ability
// The runtime value such as __process.env.ICE_CORE_*__ will be replaced by esbuild define, so the value is real-time
<% coreEnvKeys.forEach((key) => { %>
process.env.<%= key %> = __process.env.<%= key %>__;
<% }) %>

import * as runtime from '@ice/runtime/server';
import * as app from '@/app';
import runtimeModules from './runtimeModules';
import Document from '@/document';
import assetsManifest from './assets-manifest.json';
import routes from './routes';

interface RenderOptions {
  documentOnly?: boolean;
  basename?: string;
}

export async function renderToHTML(requestContext, renderOptions?: RenderOptions = {}) {
  const { documentOnly, basename } = renderOptions;
  return await runtime.renderToHTML(requestContext, {
    app,
    assetsManifest,
    routes,
    runtimeModules,
    Document,
    documentOnly,
    basename,
  });
}

export async function renderToResponse(requestContext, renderOptions?: RenderOptions = {}) {
  const { documentOnly, basename } = renderOptions;
  runtime.renderToResponse(requestContext, {
    app,
    assetsManifest,
    routes,
    runtimeModules,
    Document,
    documentOnly,
    basename,
  });
}