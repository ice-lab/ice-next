// process.env value will replace by esbuild define options
// env keys same as utils/runtimeEnv.ts
process.env.ICE_CORE_ROUTER = __process.env.ICE_CORE_ROUTER__;
process.env.ICE_CORE_MODE = __process.env.ICE_CORE_MODE__;
process.env.ICE_CORE_ERROR_BOUNDARY = __process.env.ICE_CORE_ERROR_BOUNDARY__;
process.env.ICE_CORE_INITIAL_DATA = __process.env.ICE_CORE_INITIAL_DATA__;

import { runServerApp, renderDocument as runDocumentRender } from '@ice/runtime';
import appConfig from '@/app';
import runtimeModules from './runtimeModules';
import Document from '@/document';
import assetsManifest from './assets-manifest.json';
import routes from './routes';

export async function render(requestContext) {
  return await runServerApp(requestContext, {
    appConfig,
    assetsManifest,
    routes,
    runtimeModules,
    Document,
  });
}

export async function renderDocument(requestContext) {
  return await runDocumentRender(requestContext, {
    appConfig,
    assetsManifest,
    routes,
    runtimeModules,
    Document,
  });
}